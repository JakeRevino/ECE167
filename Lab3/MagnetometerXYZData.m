close all;
clear all;

magZNeg = [-143
-143
-143
-143
-143
-143
-143
-143
-149
-149
-149
-149
-149
-156
-156
-156
-156
-143
-143
-143
-143
-149
-149
-149
-149
-156
-156
-156
-156
-174
-174
-174
-174
-174
-212
-212
-212
-212
-262
-262
-262
-262
-280
-280
-280
-280
-312
-312
-312
-312
-305
-305
-305
-305
-305
-330
-330
-330
-330
-337
-337
-337
-337
-299
-299
-299
-299
-299
-299
-299
-299
-268
-268
-268
-268
-268
-249
-249
-249
-249
-237
-237
-237
-237
-262
-262
-262
-262
-299
-299
-299
-299
-330
-330
-330
-330
-330
-330
-330
-330
-330
-343
-343
-343
-343
-318
-318
-318
-318
-330
-330
-330
-330
-293
-293
-293
-293
-268
-268
-268
-268
-268
-262
-262
-262
-262
-224
-224
-224
-224
-243
-243
-243
-243
-199
-199
-199
-199
-181
-181
-181
-181
-181
-187
-187
-187
-187
-181
-181
-181
-181
-181
-181
-181
-181
-156
-156
-156
-156
-131
-131
-131
-131
-131
-124
-124
-124
-124
-81
-81
-81
-81
-143
-143
-143
-143
-206
-206
-206
-206
-249
-249
-249
-249
-249
-293
-293
-293
-293
-299
-299
-299
-299
-293
-293
-293
-293
-293
-293
-293
-293
-262
-262
-262
-262
-262
-262
-262
-262
-262
-243
-243
-243
-243
-256
-256
-256
-256
-280
-280
-280
-280
-274
-274
-274
-274
-287
-287
-287
-287
-287
-262
-262
-262
-262
-255
-255
-255
-255
-237
-237
-237
-237
-218
-218
-218
-218
-218
-218
-218
-218
-218
-206
-206
-206
-206
-199
-199
-199
-199
-218
-218
-218
-218
-237
-237
-237
-237
-237
-237
-237
-237
-237
-237
-237
-237
-237
-243
-243
-243
-243
-237
-237
-237
-237
-224
-224
-224
-224
-249
-249
-249
-249
-274
-274
-274
-274
-274
-312
-312
-312
-312
-343
-343
-343
-343
-405
-405
-405
-405
-437
-437
-437
-437
-480
-480
-480
-480
-480
-487
-487
-487
-487
-505
-505
-505
-505
-518
-518
-518
-518
-511
-511
-511
-511
-505
-505
-505
-505
-505
-480
-480
-480
-480
-462
-462
-462
-462
-493
-493
-493
-493
-493
-493
-493
-493
-474
-474
-474
-474
-474
-474
-474
-474
-474
-462
-462
-462
-462
-480
-480
-480
-480
-505
-505
-505
-505
-512
-512
-512
-512
-512
-505
-505
-505
-505
-487
-487
-487
-487
-424
-424
-424
-424
-399
-399
-399
-399
-343
-343
-343
-343
-330
-330
-330
-330
-330
-293
-293
-293
-293
-262
-262
-262
-262
-256
-256
-256
-256
-237
-237
-237
-237
-262
-262
-262
-262
-262
-287
-287
-287
-287
-349
-349
-349
-349
-405
-405
-405
-405
-443
-443
-443
-443
-449
-449
-449
-449
-449
-437
-437
-437
-437
-405
-405
-405
-405
-374
-374
-374
-374
-330
-330
-330
-330
-324
-324
-324
-324
-324
-312
-312
-312
-312
-318
-318
-318
-318
-312
-312
-312
-312
-287
-287
-287
-287
-256
-256
-256
-256
-199
-199
-199
-199
-199
-162];

magZPos = [274
274
274
274
292
292
292
292
255
255
255
255
255
280
280
280
280
261
261
261
261
255
255
255
255
261
261
261
261
268
268
268
268
268
243
243
243
243
255
255
255
255
255
255
255
255
268
268
268
268
268
268
268
268
268
224
224
224
224
230
230
230
230
236
236
236
236
230
230
230
230
211
211
211
211
211
205
205
205
205
211
211
211
211
218
218
218
218
218
218
218
218
218
218
218
218
218
218
218
218
218
218
218
218
218
205
205
205
205
218
218
218
218
205
205
205
205
224
224
224
224
224
243
243
243
243
224
224
224
224
193
193
193
193
205
205
205
205
218
218
218
218
218
218
218
218
218
218
218
218
218
199
199
199
199
187
187
187
187
174
174
174
174
174
168
168
168
168
162
162
162
162
193
193
193
193
218
218
218
218
236
236
236
236
236
261
261
261
261
286
286
286
286
293
293
293
293
286
286
286
286
299
299
299
299
274
274
274
274
274
293
293
293
293
299
299
299
299
299
299
299
299
286
286
286
286
280
280
280
280
280
261
261
261
261
261
261
261
261
249
249
249
249
230
230
230
230
224
224
224
224
224
193
193
193
193
174
174
174
174
143
143
143
143
143
143
143
143
93
93
93
93
93
87
87
87
87
49
49
49
49
49
49
49
49
43
43
43
43
43
43
43
43
31
31
31
31
31
24
24
24
24
37
37
37
37
18
18
18
18
24
24
24
24
68
68
68
68
68
74
74
74
74
118
118
118
118
174
174
174
174
187
187
187
187
162
162
162
162
162
180
180
180
180
174
174
174
174
174
174
174
174
180
180
180
180
168
168
168
168
168
149
149
149
149
143
143
143
143
162
162
162
162
143
143
143
143
137
137
137
137
137
143
143
143
143
130
130
130
130
130
130
130
130
124
124
124
124
149
149
149
149
180
180
180
180
180
236
236
236
236
249
249
249
249
274
274
274
274
299
299
299
299
293
293
293
293
293
324
324
324
324
330
330
330
330
342
342
342
342
349
349
349
349
349
349
349
349
349
336
336
336
336
317
317
317
317
305
305
305
305
311
311
311
311
274
274
274
274
274
237
237
237
237
180
180
180
180
162
162
162
162
93
93
93
93
99
99
99
99
99
81
81
81
81
118
];

magYNeg = [-949
-949
-949
-949
-919
-919
-919
-919
-914
-914
-914
-914
-914
-920
-920
-920
-920
-919
-919
-919
-919
-914
-914
-914
-914
-943
-943
-943
-943
-914
-914
-914
-914
-914
-925
-925
-925
-925
-931
-931
-931
-931
-955
-955
-955
0
0
0
0
0
-789
-789
-789
-789
-777
-777
-777
-777
-771
-771
-771
-771
-771
-789
-789
-789
-789
-765
-765
-765
-765
-795
-795
-795
-795
-789
-789
-789
-789
-801
-801
-801
-801
-801
-753
-753
-753
-753
-789
-789
-789
-789
-777
-777
-777
-777
-783
-783
-783
-783
-765
-765
-765
-765
-765
-759
-759
-759
-759
-777
-777
-777
-777
-759
-759
-759
-759
-771
-771
-771
-771
-759
-759
-759
-759
-759
-777
-777
-777
-777
-759
-759
-759
-759
-813
-813
-813
-813
-813
-813
-813
-813
-878
-878
-878
-878
-943
-943
-943
-943
-943
-985
-985
-985
-985
-1074
-1074
-1074
-1074
-1068
-1068
-1068
-1068
-1121
-1121
-1121
-1121
-1204
-1204
-1204
-1204
-1204
-1263
-1263
-1263
-1263
-1293
-1293
-1293
-1293
-1346
-1346
-1346
-1346
-1412
-1412
-1412
-1412
-1447
-1447
-1447
-1447
-1447
-1483
-1483
-1483
-1483
-1536
-1536
-1536
-1536
-1560
-1560
-1560
-1560
-1601
-1601
-1601
-1601
-1595
-1595
-1595
-1595
-1595
-1619
-1619
-1619
-1619
-1601
-1601
-1601
-1601
-1637
-1637
-1637
-1637
-1690
-1690
-1690
-1690
-1702
-1702
-1702
-1702
-1726
-1726
-1726
-1726
-1726
-1738
-1738
-1738
-1738
-1815
-1815
-1815
-1815
-1880
-1880
-1880
-1880
-1898
-1898
-1898
-1898
-1874
-1874
-1874
-1874
-1874
-1868
-1868
-1868
-1868
-1892
-1892
-1892
-1892
-1862
-1862
-1862
-1862
-1833
-1833
-1833
-1833
-1827
-1827
-1827
-1827
-1827
-1773
-1773
-1773
-1773
-1767
-1767
-1767
-1767
-1732
-1732
-1732
-1732
-1726
-1726
-1726
-1726
-1690
-1690
-1690
-1690
-1690
-1702
-1702
-1702
-1702
-1714
-1714
-1714
-1714
-1696
-1696
-1696
-1696
-1661
-1661
-1661
-1661
-1661
-1661
-1661
-1661
-1607
-1607
-1607
-1607
-1607
-1595
-1595
-1595
-1595
-1649
-1649
-1649
-1649
-1607
-1607
-1607
-1607
-1619
-1619
-1619
-1619
-1595
-1595
-1595
-1595
-1595
-1584
-1584
-1584
-1584
-1607
-1607
-1607
-1607
-1684
-1684
-1684
-1684
-1756
-1756
-1756
-1756
-1779
-1779
-1779
-1779
-1779
-1767
-1767
-1767
-1767
-1797
-1797
-1797
-1797
-1821
-1821
-1821
-1821
-1945
-1945
-1945
-1945
-1975
-1975
-1975
-1975
-1975
-1945
-1945
-1945
-1945
-1921
-1921
-1921
-1921
-1916
-1916
-1916
-1916
-1916
-1916
-1916
-1916
-1898
-1898
-1898
-1898
-1880
-1880
-1880
-1880
-1880
-1827
-1827
-1827
-1827
-1815
-1815
-1815
-1815
-1744
-1744
-1744
-1744
-1773
-1773
-1773
-1773
-1779
-1779
-1779
-1779
-1779
-1744
-1744
-1744
-1744
-1702
-1702
-1702
-1702
-1673
-1673
-1673
-1673
-1637
-1637
-1637
-1637
-1643
-1643
-1643
-1643
-1643
-1655
-1655
-1655
-1655
-1637
-1637
-1637
-1637
-1755
-1755
-1755
-1755
-1779
-1779
-1779
-1779
-1827
-1827
-1827
-1827
-1827
-1809
-1809
-1809
-1809
-1738
-1738
-1738
-1738
-1625
-1625
-1625
-1625
-1554
-1554
-1554
-1554
-1459
-1459
-1459
-1459
-1441
-1441
-1441
-1441
-1441
-1358
-1358
-1358
-1358
-1299
-1299
-1299
-1299
-1263
-1263
-1263
-1263
-1269
-1269
-1269
-1269
-1216
-1216
-1216
-1216
-1216
-1180
-1180
-1180
-1180
-1174
-1174
-1174
-1174
-1086
-1086
-1086
-1086
-1115
-1115
-1115
-1115
-1346
-1346
-1346
-1346
-1346
-1495];

magYPos = [966
966
966
966
948
948
948
948
1002
1002
1002
1002
1002
996
996
996
996
990
990
990
990
996
996
996
996
1013
1013
1013
1013
1025
1025
1025
1025
1025
1008
1008
1008
1008
1019
1019
1019
1019
996
996
996
0
0
0
0
0
960
960
960
960
984
984
984
984
1013
1013
1013
1013
1013
1002
1002
1002
1002
966
966
966
966
972
972
972
972
930
930
930
930
930
930
930
930
930
853
853
853
853
806
806
806
806
753
753
753
753
675
675
675
675
640
640
640
640
640
587
587
587
587
569
569
569
569
533
533
533
533
492
492
492
492
456
456
456
456
456
438
438
438
438
415
415
415
415
367
367
367
367
415
415
415
415
450
450
450
450
486
486
486
486
486
545
545
545
545
569
569
569
569
616
616
616
616
652
652
652
652
699
699
699
699
699
705
705
705
705
729
729
729
729
729
729
729
729
776
776
776
776
735
735
735
735
735
782
782
782
782
753
753
753
753
717
717
717
717
717
717
717
717
735
735
735
735
770
770
770
770
770
770
770
770
770
841
841
841
841
883
883
883
883
877
877
877
877
919
919
919
919
919
919
919
919
919
936
936
936
936
871
871
871
871
841
841
841
841
901
901
901
901
901
877
877
877
877
841
841
841
841
818
818
818
818
836
836
836
836
830
830
830
830
806
806
806
806
806
806
806
806
806
747
747
747
747
705
705
705
705
699
699
699
699
658
658
658
658
658
622
622
622
622
604
604
604
604
628
628
628
628
604
604
604
604
670
670
670
670
670
646
646
646
646
646
646
646
646
640
640
640
640
705
705
705
705
782
782
782
782
782
812
812
812
812
806
806
806
806
782
782
782
782
747
747
747
747
758
758
758
758
729
729
729
729
729
699
699
699
699
705
705
705
705
776
776
776
776
794
794
794
794
741
741
741
741
741
776
776
776
776
711
711
711
711
717
717
717
717
729
729
729
729
693
693
693
693
693
693
693
693
693
705
705
705
705
723
723
723
723
753
753
753
753
776
776
776
776
824
824
824
824
824
871
871
871
871
883
883
883
883
930
930
930
930
859
859
859
859
836
836
836
836
836
818
818
818
818
764
764
764
764
735
735
735
735
675
675
675
675
640
640
640
640
640
652
652
652
652
646
646
646
646
675
675
675
675
693
693
693
693
681
681
681
681
681
664
664
664
664
658
658
658
658
640
640
640
640
628
628
628
628
652
652
652
652
664
664
664
664
664
687
687
687
687
711
711
711
711
758
758
758
758
770
770
770
770
758
758];

magXPos = [149
149
149
149
167
167
167
167
161
161
161
161
161
172
172
172
172
161
161
161
161
155
155
155
155
155
155
155
155
149
149
149
149
149
149
149
149
149
137
137
137
137
161
161
161
161
155
155
155
155
167
167
167
167
167
161
161
161
161
161
161
161
161
143
143
143
143
149
149
149
149
131
131
131
131
131
149
149
149
149
143
143
143
143
149
149
149
149
143
143
143
143
149
149
149
149
143
143
143
143
143
137
137
137
137
161
161
161
161
155
155
155
155
161
161
161
161
166
166
166
166
166
155
155
155
155
172
172
172
172
137
137
137
137
172
172
172
172
166
166
166
166
166
161
161
161
161
161
161
161
161
155
155
155
155
167
167
167
167
172
172
172
172
172
167
167
167
167
149
149
149
149
161
161
161
161
167
167
167
167
155
155
155
155
143
143
143
143
143
149
149
149
149
131
131
131
131
131
131
131
131
95
95
95
95
84
84
84
84
84
78
78
78
78
78
78
78
78
66
66
66
66
66
66
66
66
60
60
60
60
60
84
84
84
84
119
119
119
119
89
89
89
89
95
95
95
95
125
125
125
125
125
131
131
131
131
137
137
137
137
161
161
161
161
172
172
172
172
202
202
202
202
190
190
190
190
190
178
178
178
178
167
167
167
167
167
167
167
167
155
155
155
155
161
161
161
161
161
131
131
131
131
131
131
131
131
119
119
119
119
131
131
131
131
143
143
143
143
143
149
149
149
149
131
131
131
131
131
131
131
131
119
119
119
119
131
131
131
131
131
137
137
137
137
113
113
113
113
119
119
119
119
107
107
107
107
107
107
107
107
101
101
101
101
101
95
95
95
95
101
101
101
101
84
84
84
84
89
89
89
89
107
107
107
107
107
95
95
95
95
101
101
101
101
95
95
95
95
95
95
95
95
107
107
107
107
107
95
95
95
95
89
89
89
89
78
78
78
78
78
78
78
78
84
84
84
84
84
72
72
72
72
66
66
66
66
48
48
48
48
30
30
30
30
6
6
6
6
-17
-17
-17
-17
-17
-41
-41
-41
-41
-53
-53
-53
-53
-77
-77
-77
-77
-65
-65
-65
-65
-59
-59
-59
-59
-59
-35
-35
-35
-35
-35
-35
-35
-35
6
6
6
6
24
24
24
24
24
24
24
24
24
54];

magXNeg = [-2098
-2098
-2098
-2098
-2086
-2086
-2086
-2086
-2086
-2086
-2086
-2086
-2086
-2092
-2092
-2092
-2092
-2092
-2092
-2092
-2092
-2098
-2098
-2098
-2098
-2110
-2110
-2110
-2110
-2104
-2104
-2104
-2104
-2104
-2128
-2128
-2128
-2128
-2104
-2104
-2104
-2104
-2110
-2110
-2110
-2110
-2122
-2122
-2122
-2122
-2151
-2151
-2151
-2151
-2151
-2169
-2169
-2169
-2169
-2181
-2181
-2181
-2181
-2211
-2211
-2211
-2211
-2205
-2205
-2205
-2205
-2199
-2199
-2199
-2199
-2199
-2205
-2205
-2205
-2205
-2240
-2240
-2240
-2240
-2235
-2235
-2235
-2235
-2240
-2240
-2240
-2240
-2264
-2264
-2264
-2264
-2264
-2264
-2264
-2264
-2264
-2264
-2264
-2264
-2264
-2246
-2246
-2246
-2246
-2270
-2270
-2270
-2270
-2264
-2264
-2264
-2264
-2264
-2264
-2264
-2264
-2264
-2246
-2246
-2246
-2246
-2205
-2205
-2205
-2205
-2092
-2092
-2092
-2092
-2045
-2045
-2045
-2045
-2009
-2009
-2009
-2009
-2009
-1944
-1944
-1944
-1944
-1903
-1903
-1903
-1903
-1897
-1897
-1897
-1897
-1903
-1903
-1903
-1903
-1897
-1897
-1897
-1897
-1784
-1784
-1784
-1784
-1784
-1748
-1748
-1748
-1748
-1784
-1784
-1784
-1784
-1843
-1843
-1843
-1843
-1908
-1908
-1908
-1908
-1997
-1997
-1997
-1997
-1997
-2074
-2074
-2074
-2074
-2063
-2063
-2063
-2063
-2086
-2086
-2086
-2086
-2033
-2033
-2033
-2033
-1855
-1855
-1855
-1855
-1855
-1725
-1725
-1725
-1725
-1606
-1606
-1606
-1606
-1499
-1499
-1499
-1499
-1499
-1499
-1499
-1499
-1511
-1511
-1511
-1511
-1511
-1464
-1464
-1464
-1464
-1393
-1393
-1393
-1393
-1322
-1322
-1322
-1322
-1197
-1197
-1197
-1197
-1120
-1120
-1120
-1120
-1132
-1132
-1132
-1132
-1132
-1233
-1233
-1233
-1233
-1357
-1357
-1357
-1357
-1529
-1529
-1529
-1529
-1731
-1731
-1731
-1731
-1837
-1837
-1837
-1837
-1837
-1903
-1903
-1903
-1903
-1897
-1897
-1897
-1897
-1903
-1903
-1903
-1903
-1766
-1766
-1766
-1766
-1612
-1612
-1612
-1612
-1612
-1458
-1458
-1458
-1458
-1493
-1493
-1493
-1493
-1434
-1434
-1434
-1434
-1345
-1345
-1345
-1345
-1262
-1262
-1262
-1262
-1262
-1250
-1250
-1250
-1250
-1227
-1227
-1227
-1227
-1244
-1244
-1244
-1244
-1221
-1221
-1221
-1221
-1173
-1173
-1173
-1173
-1073
-1073
-1073
-1073
-1073
-1013
-1013
-1013
-1013
-990
-990
-990
-990
-1013
-1013
-1013
-1013
-1031
-1031
-1031
-1031
-1096
-1096
-1096
-1096
-1096
-1161
-1161
-1161
-1161
-1191
-1191
-1191
-1191
-1256
-1256
-1256
-1256
-1333
-1333
-1333
-1333
-1387
-1387
-1387
-1387
-1387
-1428
-1428
-1428
-1428
-1357
-1357
-1357
-1357
-1351
-1351
-1351
-1351
-1369
-1369
-1369
-1369
-1310
-1310
-1310
-1310
-1310
-1304
-1304
-1304
-1304
-1227
-1227
-1227
-1227
-1209
-1209
-1209
-1209
-1250
-1250
-1250
-1250
-1304
-1304
-1304
-1304
-1351
-1351
-1351
-1351
-1351
-1304
-1304
-1304
-1304
-1250
-1250
-1250
-1250
-1179
-1179
-1179
-1179
-1138
-1138
-1138
-1138
-1144
-1144
-1144
-1144
-1144
-1144
-1144
-1144
-1144
-1173
-1173
-1173
-1173
-1233
-1233
-1233
-1233
-1280
-1280
-1280
-1280
-1244
-1244
-1244
-1244
-1244
-1203
-1203
-1203
-1203
-1138
-1138
-1138
-1138
-1061
-1061
-1061
-1061
-1025
-1025
-1025
-1025
-978
-978
-978
-978
-942
-942];

HorizInt = 23.3328;
VertInt = 41.3831;

AveMagXPos = mean(magXPos);
AveMagXNeg = mean(magXNeg);
MagNullShiftX = (AveMagXPos + AveMagXNeg) / 2;
XMagNegShift = AveMagXNeg + MagNullShiftX;
XMagPosShift = AveMagXPos - MagNullShiftX;
magSFX = HorizInt / XMagPosShift;
magNegXCorrect = (magXNeg - MagNullShiftX) * magSFX;
magPosXCorrect = (magXPos - MagNullShiftX) * magSFX;
MagXCorrect = cat(2, magNegXCorrect, magPosXCorrect);

figure(1)
plot(MagXCorrect, '.')
title('Magnetometer X-Calibrated')

AveMagYPos = mean(magYPos);
AveMagYNeg = mean(magYNeg);
MagNullShiftY = (AveMagYPos + AveMagYNeg) / 2;
YMagNegShift = AveMagYNeg + MagNullShiftY;
YMagPosShift = AveMagYPos - MagNullShiftY;
magSFY = HorizInt / YMagPosShift;
magNegYCorrect = (magYNeg - MagNullShiftY) * magSFY;
magPosYCorrect = (magYPos - MagNullShiftY) * magSFY;
MagYCorrect = cat(2, magNegYCorrect, magPosYCorrect);

figure(2)
plot(MagYCorrect, '.')
title('Magnetometer Y-Calibrated')

AveMagZPos = mean(magZPos);
AveMagZNeg = mean(magZNeg);
MagNullShiftZ = (AveMagZPos + AveMagZNeg) / 2;
ZMagNegShift = AveMagZNeg + MagNullShiftZ;
ZMagPosShift = AveMagZPos - MagNullShiftZ;
magSFZ = VertInt / ZMagPosShift;
magNegZCorrect = (magZNeg - MagNullShiftZ) * magSFZ;
magPosZCorrect = (magZPos - MagNullShiftZ) * magSFZ;
MagZCorrect = cat(2, magNegZCorrect, magPosZCorrect);

figure(3)
plot(MagZCorrect, '.')
title('Magnetometer Z-Calibrated')










